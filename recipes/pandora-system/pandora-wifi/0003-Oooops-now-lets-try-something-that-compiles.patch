From 1f1f727cb943b9abd8e279c6b9b45ae29b6a14f6 Mon Sep 17 00:00:00 2001
From: David-John Willis <John.Willis@Distant-earth.com>
Date: Thu, 11 Jun 2009 10:00:13 +0100
Subject: [PATCH 3/5] Oooops, now lets try something that compiles ;-)

---
 sta_dk_4_0_4_32/pform/linux/src/iw_ioctl.c |   73 ++++++++++++++--------------
 1 files changed, 36 insertions(+), 37 deletions(-)

diff --git a/sta_dk_4_0_4_32/pform/linux/src/iw_ioctl.c b/sta_dk_4_0_4_32/pform/linux/src/iw_ioctl.c
index 28011e8..f925b21 100755
--- a/sta_dk_4_0_4_32/pform/linux/src/iw_ioctl.c
+++ b/sta_dk_4_0_4_32/pform/linux/src/iw_ioctl.c
@@ -124,7 +124,7 @@ static int iw_get_name(struct net_device *dev,
 {
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	int i;
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 /*
@@ -164,7 +164,7 @@ static int iw_ioctl_siwencode(struct net_device *dev,
 	int i;
 	ULONG len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	i = erq->flags & IW_ENCODE_INDEX;
@@ -254,7 +254,7 @@ static int iw_ioctl_giwencode(struct net_device *dev,
 	ULONG			len, i;
 	UINT8 			MixedMode;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	i = erq->flags & IW_ENCODE_INDEX;
@@ -273,7 +273,7 @@ static int iw_ioctl_giwencode(struct net_device *dev,
 	UtilWepStatusGet(pAdapter, (UINT8 *)&cipher, &len);
 	erq->flags = i + 1;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call cipher=%d\n", __FUNCTION__, cipher);
 #endif
 
@@ -333,7 +333,7 @@ static int iw_ioctl_siwrate(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	u32 val;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (!rrq->fixed)
@@ -352,7 +352,7 @@ static int iw_ioctl_giwrate(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	ULONG val=0, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (UtilCurrentRatesGet(pAdapter, (UINT8 *)&val, &len))
@@ -389,7 +389,7 @@ static int iw_ioctl_giwaplist(struct net_device *dev,
 	OS_802_11_BSSID_LIST_EX *list;
 	int i;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	printk("iw_ioctl_giwaplist\n");
@@ -433,7 +433,7 @@ static int iw_ioctl_siwrts(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	u32 val;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (rts->disabled)
@@ -455,7 +455,7 @@ static int iw_ioctl_giwrts(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	ULONG val, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (UtilRtsThresholdGet(pAdapter, (UINT8 *)&val, &len))
@@ -476,7 +476,7 @@ static int iw_ioctl_siwfrag(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	u32 val;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (rts->disabled)
@@ -499,7 +499,7 @@ static int iw_ioctl_giwfrag(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	ULONG val, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (UtilFragmentationThresholdGet(pAdapter, (UINT8 *)&val, &len))
@@ -520,7 +520,7 @@ static int iw_ioctl_siwap(struct net_device *dev,
 {
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	return UtilSetBSSID(pAdapter, (UINT8 *)&ap_addr->sa_data, ETH_ALEN);
@@ -533,7 +533,7 @@ static int iw_ioctl_giwap(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	ULONG len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	ap_addr->sa_family = ARPHRD_ETHER;
@@ -544,7 +544,7 @@ static int iw_ioctl_giwnickn(struct net_device *dev,
 				 struct iw_request_info *info,
 				 struct iw_point *data, char *nickname)
 {
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	data->length = 7;
@@ -560,7 +560,7 @@ static int iw_ioctl_siwfreq(struct net_device *dev,
 {
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (freq->m == -1)
@@ -594,7 +594,7 @@ static int iw_ioctl_giwfreq(struct net_device *dev, struct iw_request_info *info
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	ULONG val, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (!pAdapter->CoreHalCtx) {
@@ -620,7 +620,7 @@ static int iw_ioctl_siwessid(struct net_device *dev,
 	OS_802_11_SSID essid;
 	OS_802_11_MAC_ADDRESS bssid = { 0xff,0xff,0xff,0xff,0xff,0xff };
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 
@@ -645,7 +645,7 @@ static int iw_ioctl_giwessid(struct net_device *dev,
 	ULONG len=36;
 	OS_802_11_SSID ssid;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	memset(&ssid, 0, sizeof(OS_802_11_SSID));
@@ -664,7 +664,7 @@ static int iw_ioctl_siwmode(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	u32 val;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (*mode > IW_MODE_INFRA)
@@ -698,7 +698,7 @@ static int iw_ioctl_giwmode(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	ULONG val, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
     UtilInfrastructureModeGet(pAdapter, (UINT8 *)&val, &len);
@@ -856,7 +856,7 @@ static int iw_ioctl_siwpower(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	UINT32 val=POWER_MODE_ACTIVE;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 
@@ -898,7 +898,7 @@ static int iw_ioctl_giwpower(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	UINT32 val=POWER_MODE_ACTIVE, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	UtilPowerModeGet(pAdapter, (UINT8 *)&val, &len);
@@ -920,7 +920,7 @@ static int iw_ioctl_siwretry(struct net_device *dev,
 {
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (rrq->disabled)
@@ -949,7 +949,7 @@ static int iw_ioctl_giwretry(struct net_device *dev,
 	u16 shortretry, longretry;
 	ULONG len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	if (UtilShortRetryGet(pAdapter, (UINT8 *)&shortretry, &len)!=0 ||
@@ -990,7 +990,7 @@ static int iw_ioctl_giwtxpow(struct net_device *dev,
 	INT8 val;
 	ULONG len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 
@@ -1012,7 +1012,7 @@ static int iw_ioctl_siwscan(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	int ret;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 
@@ -1046,7 +1046,7 @@ static inline int iw_scan_list(struct net_device *dev,
 	u8 *pos;
 	spinlock_t lock;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	memset(list_buf, 0, 10000);
@@ -1182,7 +1182,6 @@ static inline int iw_scan_list(struct net_device *dev,
 			spin_unlock_bh(&lock);
 			return -E2BIG;
 		}
-		printk("current_ev=%x\n", current_ev);
         bssid = (OS_802_11_BSSID_EX *) (((char *) bssid) + bssid->Length);
 	}
 
@@ -1198,7 +1197,7 @@ static int iw_ioctl_giwscan(struct net_device *dev,
 	u32 					val, len;
 	int 					res;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 #if 0
@@ -1447,7 +1446,7 @@ static int iw_ioctl_siwauth(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	u32 val, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	switch (data->flags & IW_AUTH_INDEX) {
@@ -1517,7 +1516,7 @@ static int iw_ioctl_giwauth(struct net_device *dev,
 	PTIWLN_ADAPTER_T pAdapter = &(((tiwlan_net_dev_t *)(dev->priv))->adapter);
 	u32 val, len;
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 	switch (data->flags & IW_AUTH_INDEX) {
@@ -1557,7 +1556,7 @@ static int iw_ioctl_siwencodeext(struct net_device *dev,
 				     struct iw_point *erq, char *extra)
 {
 
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 #if 0
@@ -1734,7 +1733,7 @@ static int iw_ioctl_giwencodeext(struct net_device *dev,
 				     struct iw_request_info *info,
 				     struct iw_point *erq, char *extra)
 {
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 #if 0
@@ -1812,7 +1811,7 @@ static int iw_ioctl_siwgenie(struct net_device *dev,
 				 struct iw_request_info *info,
 				 struct iw_point *data, char *extra)
 {
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 		return -EOPNOTSUPP;
@@ -1823,7 +1822,7 @@ static int iw_ioctl_giwgenie(struct net_device *dev,
 				 struct iw_request_info *info,
 				 struct iw_point *data, char *extra)
 {
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 		return -EOPNOTSUPP;
@@ -1835,7 +1834,7 @@ static int iw_ioctl_siwmlme(struct net_device *dev,
 				struct iw_request_info *info,
 				struct iw_point *data, char *extra)
 {
-#if IOCTL_DBG
+#ifdef IOCTL_DBG
 	printk("%s Call\n", __FUNCTION__);
 #endif
 		return -EOPNOTSUPP;
@@ -1921,7 +1920,7 @@ static const struct iw_handler_def ti_iw_handler_def =
 	.standard	= (iw_handler *) ti_handler,
 //	.private	= (iw_handler *) ti_private_handler,
 //	.private_args	= (struct iw_priv_args *) ti_priv,
-	.get_wireless_stats = ti_get_wireless_stats,
+//	.get_wireless_stats = ti_get_wireless_stats,
 };
 
 void tiwlan_iwhandler_init(struct net_device *dev)
-- 
1.6.3.1

